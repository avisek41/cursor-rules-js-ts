---
description: Documentation standards for JS/TS projects — JSDoc for functions and classes, README structure, ADR format, API documentation with OpenAPI, and inline comment guidelines. Activate when user asks to write docs, add comments, document a function, create a README, write an architecture decision record (ADR), or document an API.
alwaysApply: false
---

# Documentation Standards — JavaScript / TypeScript

> **File vs Folder answer:** This rule file (`documentation.mdc`) lives as a **single file** in `.cursor/rules/`. However, the *output* it instructs Cursor to generate follows this structure:
>
> ```
> project-root/
> ├── README.md                  ← project overview (one file)
> ├── CHANGELOG.md               ← version history (one file)
> ├── CONTRIBUTING.md            ← contributor guide (one file)
> └── docs/
>     ├── adr/                   ← Architecture Decision Records (folder)
>     │   ├── 001-database.md
>     │   └── 002-auth-strategy.md
>     ├── api/                   ← OpenAPI specs (folder, if not auto-generated)
>     │   └── openapi.yaml
>     └── architecture.md        ← system diagram / overview (one file)
> ```
>
> Short-lived decisions and inline function docs live in the code. Long-lived architectural decisions live in `/docs/adr/`.

---

## Core Principles

**Document WHY, not WHAT.** Code shows what happens. Documentation explains why it was done that way, constraints, trade-offs, and non-obvious behavior.

**Write self-documenting code first.** If code needs a comment to explain *what* it does, rename the function/variable. Comment when even well-named code doesn't explain intent.

✅ **Do document:**
- Why a decision was made (ADR, inline)
- Complex algorithms and non-obvious logic
- Public APIs and exported functions (JSDoc/TSDoc)
- Known limitations, gotchas, and workarounds
- Setup, installation, environment prerequisites
- Breaking changes, deprecation timelines

❌ **Don't document:**
- Obvious code (`// increment counter` above `count++`)
- Implementation details likely to change
- Commented-out code (delete it; it lives in git)

---

## Inline Comments

```typescript
// ✅ Explains WHY — non-obvious reason
// Retry with exponential backoff — the payment provider returns 429 under load.
// Max wait is 32 s; beyond that we surface an error to the user.
const backoffMs = Math.min(Math.pow(2, retryCount) * 1_000, 32_000);

// ✅ Documents non-obvious order dependency
// Must run before initializeDatabase() — connection pool has a 5-connection hard limit
// and the analytics module opens 3 on startup, leaving none for the main service.
await setupConnectionPool();

// ✅ Explains workaround with external reference
// HACK: Force repaint to fix Safari 16 layout-shift rendering bug
// Upstream bug: https://bugs.webkit.org/show_bug.cgi?id=123456
element.style.display = 'none';
element.offsetHeight; // intentional — triggers reflow
element.style.display = '';

// ❌ States the obvious
// Set count to zero
const count = 0;

// ❌ Describes what the loop does, not why
// Loop through users
for (const user of users) { }
```

### TODO Comments — Always With Context

```typescript
// ✅
// TODO(PROJ-234): Replace with cursor-based pagination once the users
// table exceeds 1M rows. Current offset approach degrades at ~500k.
function getUsers(page: number) { }

// ❌
// TODO: fix this
function getUsers() { }
```

---

## JSDoc / TSDoc — Public API Documentation

Document every **exported** function, class, and type. In TypeScript, types carry most of the weight — JSDoc fills in semantics, constraints, and examples.

```typescript
/**
 * Calculates the total price including tax and optional discount.
 *
 * @param basePrice - Price before tax, in the specified currency. Must be ≥ 0.
 * @param taxRate   - Tax as a decimal (e.g. `0.08` for 8%). Must be in [0, 1].
 * @param options   - Optional overrides.
 * @returns Total price after tax and discount, in the same currency.
 * @throws {ValidationError} If `basePrice` is negative or `taxRate` is out of range.
 *
 * @example
 * // $100 base, 8% tax, 10% discount → $97.20
 * const total = calculateTotalPrice(100, 0.08, { discountPercent: 10 });
 */
function calculateTotalPrice(
  basePrice: number,
  taxRate: number,
  options: { discountPercent?: number } = {},
): number { }

/**
 * Fetches a user by their unique identifier.
 * Returns `null` if no user exists — does NOT throw for missing users.
 *
 * @throws {ApiError} On network failure or unexpected server error (5xx).
 *
 * @example
 * const user = await getUserById('usr_abc123' as UserId);
 * if (!user) { handle404(); }
 */
async function getUserById(id: UserId): Promise<User | null> { }
```

### What to Include in JSDoc
- ✅ Brief description of what the function *does* (not how)
- ✅ Parameter semantics, valid ranges, units
- ✅ Return value — and distinguish `null` vs `undefined` vs thrown error
- ✅ Which errors are thrown and when
- ✅ Example for non-trivial usage
- ❌ Implementation details
- ❌ Private helper functions (unless algorithm is complex and non-obvious)

---

## README.md — Every Project Needs One

```markdown
# Project Name

One or two sentences: what this project does and why it exists.

## Table of Contents
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Testing](#testing)
- [Contributing](#contributing)

## Prerequisites
- Node.js 20+
- PostgreSQL 15+
- (List any required API keys or external services)

## Installation

\`\`\`bash
git clone https://github.com/org/project.git
cd project
npm install
cp .env.example .env
# Edit .env — all required keys are documented in .env.example
npm run dev
\`\`\`

## Usage

### Basic Example
\`\`\`typescript
import { createClient } from './src/client';
const client = createClient({ apiKey: process.env.API_KEY });
const user = await client.users.getById('usr_123');
\`\`\`

### Configuration

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `DATABASE_URL` | PostgreSQL connection string | ✅ | — |
| `API_KEY` | Service API key | ✅ | — |
| `PORT` | HTTP server port | No | `3000` |
| `LOG_LEVEL` | `debug` \| `info` \| `warn` \| `error` | No | `info` |

## Testing

\`\`\`bash
npm test              # unit tests
npm run test:int      # integration tests (requires running DB)
npm run test:e2e      # end-to-end (requires full stack)
npm run test:coverage # coverage report
\`\`\`

## Contributing
See [CONTRIBUTING.md](CONTRIBUTING.md)

## License
MIT — see [LICENSE](LICENSE)
```

### README Best Practices
- Update the README as part of the PR that introduces the change
- Keep it concise — link to `/docs` for deeper content, don't duplicate it
- Add CI/coverage badges when the pipeline is stable
- Include a **Troubleshooting** section once common issues are identified

---

## Architecture Decision Records (ADRs)

**When to write an ADR:** any decision that is hard to reverse, has significant trade-offs, or will confuse a future developer who doesn't know the context.

**Where:** `/docs/adr/NNN-short-title.md` (e.g. `001-postgres-as-primary-db.md`)

**Numbering:** sequential, never reuse or delete; mark superseded ADRs with status.

```markdown
# ADR-001: PostgreSQL as Primary Database

## Status
Accepted  <!-- Draft | Accepted | Deprecated | Superseded by ADR-NNN -->

## Context
We need a primary datastore for user accounts, transactions, and analytics.
Requirements: ACID compliance, complex query support, strong community, hosted option.

## Decision
Use PostgreSQL 15 as the primary database.
Hosted on AWS RDS in the same region as the application servers.

## Consequences

### Positive
- Strong ACID guarantees — critical for financial transactions
- Native JSON support for flexible schemas where needed
- Mature ecosystem: TypeORM, Prisma, pg drivers all well-supported
- RDS managed backups and failover

### Negative
- Horizontal write scaling requires sharding (not expected at current scale)
- Schema migrations needed for structural changes
- Higher RDS cost vs serverless options

## Alternatives Considered
- **MongoDB** — rejected: schema flexibility is a liability at our data consistency requirements
- **PlanetScale** — rejected: MySQL dialect gaps with our existing query patterns
- **DynamoDB** — rejected: vendor lock-in and access pattern constraints
```

---

## API Documentation — REST

Document every endpoint with:
- HTTP method + path + description
- Path/query parameters (name, type, required/optional, description)
- Request body schema (with example)
- Response schema and all status codes
- Authentication/authorization requirements
- Error response shapes

**Use OpenAPI 3.1 (Swagger).** Generate from code annotations where possible (e.g. `@nestjs/swagger`, `fastify-swagger`). Keep the spec in version control at `/docs/api/openapi.yaml`.

```yaml
# /docs/api/openapi.yaml
openapi: 3.1.0
info:
  title: User Service API
  version: 1.0.0
paths:
  /v1/users/{userId}:
    get:
      summary: Get user by ID
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: string, pattern: '^usr_[a-z0-9]+$' }
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
        '404':
          description: User not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiError' }
```

---

## Changelog — `CHANGELOG.md`

Follow [Keep a Changelog](https://keepachangelog.com) format. Use [Semantic Versioning](https://semver.org).

```markdown
# Changelog

## [Unreleased]

## [2.1.0] - 2025-04-10
### Added
- OAuth2 login via Google and GitHub (#234)
- Cursor-based pagination on /v1/users (#241)

### Changed
- `getUserById` now returns `null` instead of throwing `NotFoundError` for missing users

### Deprecated
- `offset` parameter on /v1/users — use `cursor` instead; will be removed in v3.0.0

## [2.0.0] - 2025-03-01
### Breaking Changes
- Response shape for `/v1/orders` changed — see migration guide in docs/migrations/v2.md
```

---

## Documentation Review Checklist

- [ ] All exported functions and classes have JSDoc
- [ ] JSDoc includes `@param`, `@returns`, `@throws`, `@example` where applicable
- [ ] README is complete and matches current setup steps
- [ ] `.env.example` documents every environment variable
- [ ] CHANGELOG updated for new features and breaking changes
- [ ] ADR written for any significant or irreversible architectural decision
- [ ] API docs updated when endpoints added or changed
- [ ] No commented-out code; no outdated comments
- [ ] TODOs include ticket references
